<div style="text-align:center;font-size:16px">
    <h1>操作系统(2)第七、八章作业</h1>
</div>
<div style="text-align:center;font-size:10px;font-family:仿宋">
    <h1 style="font-weight:normal">22121630 汪江豪</h1>
</div>

### 1. 假定一个盘组共有100个柱面，每个柱面上有16个磁道，每个磁道分成4个扇区。
#### 1) 整个磁盘空间共有多少个存储块？
$100 \times 16 \times 4 = 6400$，所以有6400个存储块。
#### 2) 若用字长32位的单元来构造位示图，共需要多少个字？
$6400 \div 32 = 200$，需要200个字。
#### 3) 位示图中第18个字的第16位对应的块号是多少?
此处认为盘块号从1开始，则$17 \times 32 + 16 = 660$，所以对应的块号是660.

### 2. 假设磁头当前位于第105道，正在向磁道序号增加的方向移动。现有一个磁道访问请求序列为35，45，12，68，110，180，170，195，采用SCAN调度(电梯调度)算法得到的磁道访问序列和平均寻道长度是多少？
```python
                        105 -> 110 -> 170 -> 180 -> 195
12 <- 35 <- 45 <- 68 <---------------------------------
```
共移动了 (195 - 105) + (195 - 12) = 273 个磁道，有8个序列，故平均寻道长度为$273 \div 8 = 34.125$.

### 3. 某文件系统采用索引结点存放文件的属性和地址信息，簇大小为4KB。每个文件索引结点占64B，有11个地址项，其中直接地址项8个，一级、二级和三级间接地址项各1个，每个地址项长度为4B，请回答下列问题：
#### 1) 该文件系统能支持的最大文件长度是多少? (给出计算表达式即可)
簇大小为4KB，一个簇能存$4KB \div 4B = 1024$个地址。
所以能存储的最大文件长度为：$(8 \times 4KB) + (1024 \times 4KB) + (1024^2 \times 4KB) + (1024^3 \times 4KB)$
#### 2) 文件系统用$1M(1M = 2^{20}$)个簇存放文件索引结点，用512M个簇存放文件数据。若一个图像文件的大小为5600B，则该文件系统最多能存放多少个这样的图像文件？
一个图像文件大小5600B，一个簇大小4KB，一个文件需要$\lceil \frac{5600B}{4KB} \rceil = 2$个簇，$512M \div 2 = 256M$个图像。
该文件系统可存$1M \times 4KB \div 64B = 64M$个文件索引结点。
取64M和256M的较小值，故最多能存64M个图像文件。
#### 3) 若文件F1的大小为6KB，文件F2的大小为40KB，则该文件系统获取F1和F2最后一个簇的簇号需要的时间是否相同？为什么？
不同，原因：
- F1大小$6KB < 4KB \times 8$，可用直接地址项表示。
- F2大小$4KB \times 8 < 40KB < 4KB \times 8 + 4KB \times 1024$，访问最后一个簇需要先访问一级间接地址索引表，再访问直接地址。

### 4. 在某个文件系统中，每个盘块为512个字节，文件控制块占64个字节，其中文件名占8个字节。如果索引结点编号占2个字节，对一个存放在磁盘上的、256个目录项的目录，试比较引入索引结点前后，为找到其中一个文件的FCB，平均启动磁盘的次数。
- 引入索引结点前：每个目录项存FCB。每个盘块存$512\div64=8$个目录项，需要$256\div8=32$个盘块存整个目录，平均启动磁盘次数$32\div2=16$次。
- 引入索引结点后：每个目录项只存放文件名和索引结点编号，占$8+2=10$字节。每个盘块存$\lfloor 512 \div 10\rfloor = 51$个索引，需要$\lceil 256 \div 51\rceil = 6$个盘块存整个目录，平均启动次数$6\div2=3$次。找到索引后，还要找一次FCB，故总共4次。

### 5.  在经典UNIX类操作系统中，采用混合索引结构组织文件数据块，采用成组链接法组织空闲数据块。
#### 1) 请论述根据文件读写指针，如何确定文件数据块在块设备上的位置。
文件数据块的位置通过混合索引结构和文件读写指针共同确定。
- 混合索引结构通常包括：直接索引，一级间接索引，二级间接索引，三级间接索引。
- 文件读写指针指示了当前读写操作在文件中的偏移量，以字节为单位。
- 首先根据文件读写指针的偏移量，计算它位于文件的哪个数据块。数据块号=偏移量/数据块大小。
- 如果数据块号小于直接索引的数量，直接从inode中获取数据块的位置。
- 如果数据块号在直接索引和一级间接索引的范围内，先从inode中获取一级间接索引块的位置，再从一级间接索引块中获取数据块的位置。其他级索引同理进行逐级查找。
- 然后计算块内偏移，读写数据。
#### 2) 请论述混合索引结构优缺点。
- 优点：支持不同大小的文件，小文件直接索引，大文件用多级间接索引。节省存储空间。
- 缺点：需要维护多级索引，管理复杂。对于大文件，访问数据需要多次访问磁盘才能定位，增加时间开销。
#### 3) 请论述当向文件末尾追加数据时,如何申请空闲数据块；删除文件时，如何回收空闲数据块。
追加数据：
- 首先从超级块中读取当前组的空闲块数量。如果超级块中有空闲块，直接分配一个空闲块。
- 如果超级块中的空闲块已用完，读取超级块中指向下一组的指针。将下一组空闲块的信息加载到超级块中，释放原超级块中的空闲块组。
- 然后从超级块中分配一个空闲块，并更新超级块中空闲块数量。
- 再将新分配的空闲块地址添加到文件的索引结构中，更新文件大小和修改时间。

删除文件：
- 遍历文件索引结构，获取文件的所以数据块地址。
- 将每个数据块标记为空闲，并将其假如空闲块组。如果当前空闲块数量未达到上限，将数据块假如当前组；如果当前组已满，将当前组的信息写入一个新的空闲块，并将该块作为新组的起始块。
- 然后更新超级块中空闲块数量和指针，指向最新的空闲块组。
- 最后将文件的inode标记为空闲，加入空闲inode列表。

